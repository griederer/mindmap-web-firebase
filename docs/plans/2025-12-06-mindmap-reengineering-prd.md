# PRD: MyMindmap Reengineering v2.0

**Document Version:** 1.0
**Date:** 2025-12-06
**Status:** Draft
**Author:** Claude Code

---

## 1. Executive Summary

This PRD defines a complete reengineering of MyMindmap from a simple tree-based visualization tool into a **cognitive-science-driven**, **semantically-rich knowledge mapping platform**. The transformation incorporates:

- **Cognitive Science Principles** - Layouts, colors, and visual hierarchies optimized for human cognition
- **Rich Nodes** - Mixed content (text, images, schemas, diagrams) in single nodes
- **Semantic Graph Model** - Beyond trees: typed relationships, ontologies, and knowledge graphs
- **Multiple Layout Engines** - Radial, fishbone, org-chart, timeline structures
- **Presentation Modes** - Zen mode (focus), Pitch mode (presentation flow)
- **Claude Code Integration** - All content generated and loaded from Claude Code

**Critical Constraint:** The entire system must support files generated by Claude Code via MCP tools, enabling AI-assisted knowledge graph creation.

---

## 2. Vision & Goals

### 2.1 Vision Statement

Transform MyMindmap into a **cognitive knowledge canvas** where complex ideas are visualized as interconnected semantic units, not just hierarchical trees.

### 2.2 Primary Goals

| Goal | Success Metric |
|------|----------------|
| Support rich multimedia nodes | Nodes can display text + images + schemas simultaneously |
| Implement semantic relationships | Support typed edges: is-a, part-of, causes, etc. |
| Multiple layout structures | At least 5 layout types available |
| Claude Code compatibility | 100% of features accessible via MCP tools |
| Cognitive optimization | Layout follows cognitive science principles |

### 2.3 Non-Goals (v2.0)

- Real-time collaboration
- Cloud sync (keep local-first)
- Mobile native apps (web responsive only)

---

## 3. Cognitive Science Foundation

### 3.1 Core Principles

| Principle | Implementation |
|-----------|----------------|
| **Central Topic Layout** | Root node always centered; branches radiate outward |
| **Color Coding** | Each primary branch has distinct color; children inherit with saturation variation |
| **Image + Text Integration** | Nodes support embedded images alongside text (dual coding theory) |
| **Concise Node Text** | Max ~30 characters per node title; description in expandable panel |
| **Visual Hierarchy** | Level 0: largest/boldest; decreasing size by depth |
| **Organic Flow** | Curved, flowing connections (not rigid straight lines) |
| **Spatial Memory** | Consistent positions; radial spread for memorability |

### 3.2 Cognitive Load Reduction

| Feature | Purpose |
|---------|---------|
| **Doodles/Sketches** | Hand-drawn style option reduces cognitive formality |
| **Line Thickness = Importance** | Thicker lines for critical relationships |
| **Bold Text Emphasis** | Key terms highlighted within nodes |
| **Progressive Disclosure** | Collapsed branches by default; expand on demand |
| **Focus Mode (Zen)** | Hide all but selected branch |

---

## 4. Data Model (v2.0 Schema)

### 4.1 Rich Node Schema

```typescript
interface RichNode {
  // Identity
  id: string;                    // UUID

  // Content (Rich)
  content: {
    title: string;               // Max 50 chars, displayed on node
    subtitle?: string;           // Secondary text below title
    body?: string;               // Markdown content for detail panel
    media?: NodeMedia[];         // Embedded images, diagrams, videos
    schema?: EmbeddedSchema;     // Inline diagram/schema (mermaid, SVG)
  };

  // Visual Style
  style: {
    shape: 'rectangle' | 'rounded' | 'ellipse' | 'pill' | 'organic' | 'none';
    backgroundColor?: string;    // Hex or 'transparent'
    borderColor?: string;
    borderWidth?: number;
    fontSize?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
    fontWeight?: 'normal' | 'bold';
    textColor?: string;
    width?: number;              // Auto if not set
    height?: number;
  };

  // Layout
  position: { x: number; y: number };   // Canvas coordinates
  layoutHints?: {
    preferredDirection?: 'left' | 'right' | 'up' | 'down' | 'radial';
    locked?: boolean;            // Prevent auto-layout changes
    groupId?: string;            // Visual grouping
  };

  // Hierarchy (Tree Relationships)
  parentId: string | null;
  children: string[];
  level: number;

  // Semantic Annotations
  semantic?: {
    type?: string;               // Node type from ontology (e.g., "Concept", "Person", "Event")
    tags?: string[];             // Free-form tags
    uri?: string;                // External identifier (Wikipedia, Wikidata)
  };

  // State
  isExpanded: boolean;
  isVisible: boolean;
  isFocused?: boolean;

  // Metadata
  createdAt: number;
  updatedAt: number;
  createdBy?: string;            // "claude-code" | "user"
}

interface NodeMedia {
  id: string;
  type: 'image' | 'svg' | 'video' | 'iframe';
  data: string;                  // Base64 or URL
  filename?: string;
  width?: number;
  height?: number;
  caption?: string;
  position: 'inline' | 'background' | 'icon';
}

interface EmbeddedSchema {
  type: 'mermaid' | 'svg' | 'canvas';
  content: string;               // Mermaid code or SVG markup
  width?: number;
  height?: number;
}
```

### 4.2 Semantic Edge Schema

```typescript
interface SemanticEdge {
  id: string;

  // Endpoints
  sourceId: string;              // From node
  targetId: string;              // To node

  // Semantic Type
  relationshipType: RelationshipType;

  // Visual
  style: {
    color?: string;
    lineType: 'solid' | 'dashed' | 'dotted';
    lineWidth: number;           // 1-6
    curvature: 'straight' | 'curved' | 'organic';
    arrowHead: 'none' | 'arrow' | 'diamond' | 'circle';
    arrowTail: 'none' | 'arrow' | 'diamond' | 'circle';
  };

  // Label
  label?: string;                // Displayed on edge
  labelPosition?: number;        // 0-1 along edge

  // State
  isVisible: boolean;

  // Metadata
  createdAt: number;
  updatedAt: number;
}

interface RelationshipType {
  id: string;
  name: string;                  // Display name: "is a", "part of", "causes"
  semanticUri?: string;          // OWL/RDF predicate URI
  category: 'hierarchical' | 'associative' | 'causal' | 'temporal' | 'custom';
  defaultStyle: SemanticEdge['style'];
}

// Predefined Semantic Relationship Types
const SEMANTIC_RELATIONSHIPS: RelationshipType[] = [
  { id: 'is-a', name: 'is a', category: 'hierarchical', semanticUri: 'rdf:type' },
  { id: 'part-of', name: 'part of', category: 'hierarchical', semanticUri: 'dcterms:isPartOf' },
  { id: 'has-part', name: 'has part', category: 'hierarchical', semanticUri: 'dcterms:hasPart' },
  { id: 'causes', name: 'causes', category: 'causal', semanticUri: 'cso:causes' },
  { id: 'caused-by', name: 'caused by', category: 'causal' },
  { id: 'related-to', name: 'related to', category: 'associative', semanticUri: 'skos:related' },
  { id: 'depends-on', name: 'depends on', category: 'associative' },
  { id: 'contradicts', name: 'contradicts', category: 'associative' },
  { id: 'before', name: 'before', category: 'temporal' },
  { id: 'after', name: 'after', category: 'temporal' },
  { id: 'during', name: 'during', category: 'temporal' },
];
```

### 4.3 Project Schema v2.0

```typescript
interface ProjectV2 {
  // Version marker
  schemaVersion: '2.0';

  // Identity
  projectId: string;

  // Metadata
  metadata: {
    title: string;
    description?: string;
    author?: string;
    createdAt: number;
    updatedAt: number;
    version: string;
    tags?: string[];
    thumbnail?: string;
  };

  // Graph Data (not just tree!)
  graph: {
    nodes: Record<string, RichNode>;
    edges: SemanticEdge[];
    rootNodeId: string;          // Entry point for tree layouts
  };

  // Ontology/Schema
  ontology?: {
    nodeTypes: NodeTypeDefinition[];
    relationshipTypes: RelationshipType[];
    namespaces?: Record<string, string>;  // prefix -> URI
  };

  // Layout Configuration
  layout: {
    type: 'radial' | 'tree-horizontal' | 'tree-vertical' | 'fishbone' | 'org-chart' | 'timeline' | 'freeform';
    settings: LayoutSettings;
  };

  // Visual Themes
  theme: {
    id: string;
    name: string;
    colors: {
      background: string;
      nodeDefault: string;
      branchColors: string[];    // Rotating colors for L1 branches
      edgeDefault: string;
      text: string;
      textSecondary: string;
    };
    fonts: {
      title: string;
      body: string;
    };
    nodeStyle: Partial<RichNode['style']>;
    edgeStyle: Partial<SemanticEdge['style']>;
  };

  // Presentation
  presentation?: {
    enabled: boolean;
    slides: PresentationSlide[];
    transitions: TransitionType;
  };

  // View State (not persisted to file, but can be)
  viewState?: {
    zoom: number;
    pan: { x: number; y: number };
    focusedNodeId?: string;
    selectedNodeIds: string[];
    expandedNodeIds: string[];
  };
}

interface LayoutSettings {
  // Common
  nodeSpacing: number;
  levelSpacing: number;

  // Radial specific
  startAngle?: number;
  endAngle?: number;
  radiusIncrement?: number;

  // Tree specific
  direction?: 'left-to-right' | 'right-to-left' | 'top-to-bottom' | 'bottom-to-top';

  // Fishbone specific
  spineAngle?: number;
  boneAngle?: number;
}

interface PresentationSlide {
  id: string;
  name: string;
  focusNodeIds: string[];        // Nodes visible in this slide
  zoom: number;
  pan: { x: number; y: number };
  notes?: string;
  duration?: number;             // Auto-advance seconds
}
```

---

## 5. Feature Specifications

### 5.1 Rich Nodes

#### F1: Multi-Content Nodes

**Description:** Nodes can contain any combination of:
- Title text (always visible)
- Subtitle text
- Embedded image(s)
- Embedded diagram (Mermaid/SVG)
- Markdown body (in detail panel)

**User Stories:**
- As a user, I can add an image to a node that displays inline
- As a user, I can embed a Mermaid diagram in a node
- As Claude Code, I can generate nodes with pre-embedded images and schemas

**Acceptance Criteria:**
- [ ] Node renders title + image when both present
- [ ] Image respects position: inline (below title), background (behind), icon (small left)
- [ ] Mermaid diagrams render correctly inside nodes
- [ ] Node auto-sizes to fit content

#### F2: Node Styling

**Description:** Per-node visual customization.

**Acceptance Criteria:**
- [ ] 6 shape options: rectangle, rounded, ellipse, pill, organic, none (text only)
- [ ] Background color with opacity
- [ ] Border color and width
- [ ] Font size (5 options)
- [ ] Font weight (normal/bold)
- [ ] Width/height override

### 5.2 Semantic Relationships

#### F3: Typed Edges

**Description:** Relationships between nodes have semantic meaning.

**Predefined Types:**
1. `is-a` - Classification (Dog is-a Animal)
2. `part-of` - Composition (Wheel part-of Car)
3. `has-part` - Inverse composition
4. `causes` - Causation
5. `related-to` - Generic association
6. `depends-on` - Dependency
7. `contradicts` - Opposition
8. `before/after/during` - Temporal

**Acceptance Criteria:**
- [ ] Can create edge between any two nodes
- [ ] Edge has selectable relationship type
- [ ] Edge displays label on hover
- [ ] Different types have different default colors
- [ ] Edges support directionality (arrows)

#### F4: Ontology-Driven Suggestions

**Description:** System suggests relationships based on node types.

**Example:** If node A is type "Cause" and node B is type "Effect", suggest "causes" relationship.

**Acceptance Criteria:**
- [ ] Node types can be defined per project
- [ ] System suggests applicable relationship types
- [ ] Suggestions appear in context menu

### 5.3 Layout Engines

#### F5: Multiple Layout Types

| Layout | Description | Use Case |
|--------|-------------|----------|
| **Radial** | Center node, branches spiral outward | General mindmaps |
| **Tree Horizontal** | Root left, children flow right | Hierarchies, outlines |
| **Tree Vertical** | Root top, children flow down | Org charts |
| **Fishbone** | Cause-effect spine with angled branches | Problem analysis |
| **Timeline** | Linear with temporal ordering | Historical, project plans |
| **Freeform** | No auto-layout, manual positioning | Custom diagrams |

**Acceptance Criteria:**
- [ ] User can switch layouts without data loss
- [ ] Layout preserves relative node ordering
- [ ] Animation when switching layouts
- [ ] Per-node layout lock (exclude from auto-layout)

#### F6: Radial Layout Engine

**Algorithm:**
1. Root at center (0, 0)
2. Level 1 nodes distributed in circle, radius R1
3. Each L1 node's children in arc, radius R1 + increment
4. Angles calculated to prevent overlap
5. Connection curves follow organic Bezier paths

**Acceptance Criteria:**
- [ ] Even distribution of branches
- [ ] No node overlap
- [ ] Curved, organic connections (not straight lines)
- [ ] Configurable start/end angles (e.g., 270-degree spread)

### 5.4 Presentation Modes

#### F7: Zen Mode (Focus)

**Description:** Hide everything except selected branch path.

**Behavior:**
1. Select a node
2. Activate Zen mode (keyboard: Z)
3. Only ancestors + descendants of selected node visible
4. Background dims
5. Press Escape to exit

**Acceptance Criteria:**
- [ ] Toggle with Z key or toolbar button
- [ ] Smooth fade animation
- [ ] Dimmed background for hidden nodes
- [ ] Can navigate within visible branch

#### F8: Pitch Mode (Presentation)

**Description:** Slideshow-style navigation through mindmap.

**Behavior:**
1. Define slides (each slide = focused nodes + zoom/pan)
2. Enter Pitch mode
3. Navigate slides with arrow keys
4. Auto-advance option

**Acceptance Criteria:**
- [ ] Create/edit slides in sidebar
- [ ] Smooth transitions between slides
- [ ] Speaker notes per slide
- [ ] Export to PDF option
- [ ] Keyboard navigation (arrows, space, escape)

### 5.5 Claude Code Integration

#### F9: MCP-Compatible File Format

**Description:** All project data in a single JSON file that Claude Code MCP tools can generate.

**File Structure:**
```json
{
  "schemaVersion": "2.0",
  "projectId": "generated-by-claude",
  "metadata": { ... },
  "graph": {
    "nodes": { ... },
    "edges": [ ... ],
    "rootNodeId": "root"
  },
  "layout": { ... },
  "theme": { ... }
}
```

**Acceptance Criteria:**
- [ ] Load any valid v2.0 JSON from URL or file
- [ ] MCP tools can create complete projects
- [ ] MCP tools can add nodes with images (base64)
- [ ] MCP tools can define relationships
- [ ] Backward compatible with v1.x format

#### F10: URL-Based Project Loading

**Description:** Load project from URL parameter.

**URL Format:**
```
https://mymindmap.app/?project=https://example.com/mymap.json
```

**Acceptance Criteria:**
- [ ] Parse `project` URL parameter
- [ ] Fetch and load remote JSON
- [ ] Show loading indicator
- [ ] Handle CORS errors gracefully

---

## 6. Implementation Tasks

### Phase 1: Data Model & Core (Week 1-2)

| Task ID | Task | Estimate | Dependencies |
|---------|------|----------|--------------|
| T1.1 | Define RichNode TypeScript interface | 2h | - |
| T1.2 | Define SemanticEdge interface | 1h | - |
| T1.3 | Define ProjectV2 interface | 2h | T1.1, T1.2 |
| T1.4 | Create schema validation with Zod | 3h | T1.3 |
| T1.5 | Update projectStore for v2 format | 4h | T1.4 |
| T1.6 | Update projectLoader for v2 + backward compat | 3h | T1.5 |
| T1.7 | Create migration util v1 -> v2 | 2h | T1.6 |

### Phase 2: Rich Node Rendering (Week 2-3)

| Task ID | Task | Estimate | Dependencies |
|---------|------|----------|--------------|
| T2.1 | Create RichNodeRenderer component | 6h | T1.1 |
| T2.2 | Implement shape rendering (6 types) | 4h | T2.1 |
| T2.3 | Implement image embedding | 4h | T2.1 |
| T2.4 | Implement Mermaid diagram embedding | 4h | T2.1 |
| T2.5 | Implement node auto-sizing | 3h | T2.1 |
| T2.6 | Create NodeStyleEditor component | 4h | T2.1 |

### Phase 3: Semantic Edges (Week 3-4)

| Task ID | Task | Estimate | Dependencies |
|---------|------|----------|--------------|
| T3.1 | Create SemanticEdgeRenderer component | 5h | T1.2 |
| T3.2 | Implement curved Bezier connections | 4h | T3.1 |
| T3.3 | Implement arrow heads/tails | 2h | T3.1 |
| T3.4 | Implement edge labels | 2h | T3.1 |
| T3.5 | Create EdgeTypeSelector component | 3h | T3.1 |
| T3.6 | Create edge creation UI (drag between nodes) | 4h | T3.1 |

### Phase 4: Layout Engines (Week 4-5)

| Task ID | Task | Estimate | Dependencies |
|---------|------|----------|--------------|
| T4.1 | Create LayoutEngine interface | 2h | - |
| T4.2 | Implement RadialLayout engine | 6h | T4.1 |
| T4.3 | Implement TreeHorizontalLayout engine | 4h | T4.1 |
| T4.4 | Implement TreeVerticalLayout engine | 3h | T4.3 |
| T4.5 | Implement FishboneLayout engine | 5h | T4.1 |
| T4.6 | Implement TimelineLayout engine | 4h | T4.1 |
| T4.7 | Create LayoutSwitcher component | 3h | T4.2-T4.6 |
| T4.8 | Implement layout transition animations | 4h | T4.7 |

### Phase 5: Presentation Modes (Week 5-6)

| Task ID | Task | Estimate | Dependencies |
|---------|------|----------|--------------|
| T5.1 | Implement Zen mode (focus) | 4h | T2.1 |
| T5.2 | Create PresentationStore | 3h | - |
| T5.3 | Create SlideEditor component | 4h | T5.2 |
| T5.4 | Implement Pitch mode navigation | 4h | T5.2 |
| T5.5 | Implement slide transitions | 3h | T5.4 |
| T5.6 | Add keyboard controls | 2h | T5.4 |

### Phase 6: Claude Code Integration (Week 6)

| Task ID | Task | Estimate | Dependencies |
|---------|------|----------|--------------|
| T6.1 | Update MCP server for v2 format | 4h | T1.6 |
| T6.2 | Add MCP tool: create_rich_node | 3h | T6.1 |
| T6.3 | Add MCP tool: create_semantic_edge | 2h | T6.1 |
| T6.4 | Add MCP tool: set_layout | 2h | T6.1 |
| T6.5 | Implement URL-based project loading | 2h | T1.6 |
| T6.6 | Add base64 image support in MCP | 2h | T6.2 |

### Phase 7: Polish & Testing (Week 7)

| Task ID | Task | Estimate | Dependencies |
|---------|------|----------|--------------|
| T7.1 | Write unit tests for data model | 4h | T1.* |
| T7.2 | Write unit tests for layout engines | 4h | T4.* |
| T7.3 | Write integration tests for project loading | 3h | T1.6 |
| T7.4 | Write E2E tests for presentation mode | 3h | T5.* |
| T7.5 | Performance optimization | 4h | All |
| T7.6 | Accessibility audit | 2h | All |

---

## 7. Test Plan

### 7.1 Unit Tests

#### Data Model Tests

```typescript
describe('RichNode', () => {
  it('validates node with minimal fields', () => {});
  it('validates node with all fields', () => {});
  it('rejects node without id', () => {});
  it('validates embedded media', () => {});
  it('validates mermaid schema', () => {});
});

describe('SemanticEdge', () => {
  it('validates edge with required fields', () => {});
  it('validates relationship type', () => {});
  it('rejects edge with missing source/target', () => {});
});

describe('ProjectV2', () => {
  it('validates complete project', () => {});
  it('migrates v1 project to v2', () => {});
  it('preserves data during migration', () => {});
});
```

#### Layout Engine Tests

```typescript
describe('RadialLayout', () => {
  it('places root at center', () => {});
  it('distributes L1 nodes evenly', () => {});
  it('prevents node overlap', () => {});
  it('respects angle constraints', () => {});
});

describe('TreeLayout', () => {
  it('maintains parent-child relationships', () => {});
  it('calculates correct level spacing', () => {});
  it('handles unbalanced trees', () => {});
});
```

### 7.2 Integration Tests

```typescript
describe('Project Loading', () => {
  it('loads v2 project from file', async () => {});
  it('loads v1 project and migrates', async () => {});
  it('loads project from URL', async () => {});
  it('handles malformed JSON gracefully', async () => {});
});

describe('Claude Code MCP', () => {
  it('creates project via MCP', async () => {});
  it('adds rich node via MCP', async () => {});
  it('creates semantic edge via MCP', async () => {});
  it('embeds image via MCP', async () => {});
});
```

### 7.3 E2E Tests

```typescript
describe('Presentation Mode', () => {
  it('enters Zen mode on Z key', () => {});
  it('shows only focused branch in Zen mode', () => {});
  it('exits Zen mode on Escape', () => {});

  it('enters Pitch mode', () => {});
  it('navigates slides with arrows', () => {});
  it('shows speaker notes', () => {});
});

describe('Layout Switching', () => {
  it('switches from tree to radial', () => {});
  it('animates transition', () => {});
  it('preserves node data', () => {});
});
```

### 7.4 Visual Regression Tests

- Screenshot comparison for each layout type
- Screenshot comparison for rich node variations
- Screenshot comparison for different themes

---

## 8. MCP Tool Definitions

### 8.1 Updated MCP Tools for v2

```typescript
// Create project with v2 schema
tool: create_mindmap_v2
params: {
  topic: string;
  layout?: 'radial' | 'tree-horizontal' | 'tree-vertical' | 'fishbone' | 'timeline' | 'freeform';
  theme?: string;
  nodeDescriptions?: string[];  // Optional initial nodes
}

// Add rich node
tool: add_rich_node
params: {
  projectName: string;
  title: string;
  level: number;
  parentTitle?: string;
  subtitle?: string;
  body?: string;
  imageUrl?: string;
  imageBase64?: string;
  mermaid?: string;
  shape?: 'rectangle' | 'rounded' | 'ellipse' | 'pill' | 'organic' | 'none';
  backgroundColor?: string;
  nodeType?: string;  // Semantic type
  tags?: string[];
}

// Create semantic edge
tool: create_semantic_edge
params: {
  projectName: string;
  fromNodeTitle: string;
  toNodeTitle: string;
  relationshipType: string;  // 'is-a', 'part-of', 'causes', etc.
  label?: string;
  color?: string;
  lineType?: 'solid' | 'dashed' | 'dotted';
}

// Set project layout
tool: set_layout
params: {
  projectName: string;
  layout: 'radial' | 'tree-horizontal' | 'tree-vertical' | 'fishbone' | 'timeline' | 'freeform';
  settings?: LayoutSettings;
}

// Create presentation slide
tool: create_slide
params: {
  projectName: string;
  name: string;
  focusNodeTitles: string[];
  notes?: string;
  zoom?: number;
}
```

---

## 9. File Format Example

### 9.1 Complete v2 Project Example

```json
{
  "schemaVersion": "2.0",
  "projectId": "ai-risks-semantic",
  "metadata": {
    "title": "AI Risks Analysis",
    "description": "Semantic knowledge graph of AI risks",
    "createdAt": 1733500000000,
    "updatedAt": 1733500000000,
    "version": "1.0.0",
    "tags": ["ai", "risks", "analysis"]
  },
  "graph": {
    "rootNodeId": "root",
    "nodes": {
      "root": {
        "id": "root",
        "content": {
          "title": "AI Risks",
          "subtitle": "A comprehensive analysis",
          "media": [{
            "id": "img-1",
            "type": "image",
            "data": "data:image/png;base64,...",
            "position": "icon"
          }]
        },
        "style": {
          "shape": "ellipse",
          "backgroundColor": "#3B82F6",
          "fontSize": "xl",
          "fontWeight": "bold"
        },
        "position": { "x": 0, "y": 0 },
        "parentId": null,
        "children": ["safety", "ethics", "economic"],
        "level": 0,
        "semantic": {
          "type": "Topic",
          "tags": ["main-topic"]
        },
        "isExpanded": true,
        "isVisible": true,
        "createdAt": 1733500000000,
        "updatedAt": 1733500000000
      },
      "safety": {
        "id": "safety",
        "content": {
          "title": "Safety Risks",
          "body": "## Overview\n\nSafety risks include...",
          "schema": {
            "type": "mermaid",
            "content": "graph TD\n  A[Alignment] --> B[Control]\n  B --> C[Safety]"
          }
        },
        "style": {
          "shape": "rounded",
          "backgroundColor": "#EF4444"
        },
        "position": { "x": 300, "y": -100 },
        "parentId": "root",
        "children": ["alignment", "autonomy"],
        "level": 1,
        "semantic": {
          "type": "RiskCategory"
        },
        "isExpanded": true,
        "isVisible": true,
        "createdAt": 1733500000000,
        "updatedAt": 1733500000000
      }
    },
    "edges": [
      {
        "id": "edge-1",
        "sourceId": "alignment",
        "targetId": "autonomy",
        "relationshipType": {
          "id": "causes",
          "name": "causes",
          "category": "causal"
        },
        "style": {
          "color": "#EF4444",
          "lineType": "dashed",
          "lineWidth": 2,
          "curvature": "curved",
          "arrowHead": "arrow",
          "arrowTail": "none"
        },
        "label": "can lead to",
        "isVisible": true,
        "createdAt": 1733500000000,
        "updatedAt": 1733500000000
      }
    ]
  },
  "layout": {
    "type": "radial",
    "settings": {
      "nodeSpacing": 80,
      "levelSpacing": 200,
      "startAngle": 0,
      "endAngle": 360,
      "radiusIncrement": 200
    }
  },
  "theme": {
    "id": "default-light",
    "name": "Light",
    "colors": {
      "background": "#FFFFFF",
      "nodeDefault": "#F3F4F6",
      "branchColors": ["#EF4444", "#F59E0B", "#10B981", "#3B82F6", "#8B5CF6"],
      "edgeDefault": "#9CA3AF",
      "text": "#111827",
      "textSecondary": "#6B7280"
    },
    "fonts": {
      "title": "Inter",
      "body": "Inter"
    }
  },
  "presentation": {
    "enabled": true,
    "slides": [
      {
        "id": "slide-1",
        "name": "Introduction",
        "focusNodeIds": ["root"],
        "zoom": 1.0,
        "pan": { "x": 0, "y": 0 },
        "notes": "Start with overview of AI risks landscape"
      },
      {
        "id": "slide-2",
        "name": "Safety Deep Dive",
        "focusNodeIds": ["root", "safety", "alignment", "autonomy"],
        "zoom": 0.8,
        "pan": { "x": 200, "y": 0 }
      }
    ],
    "transitions": "smooth"
  }
}
```

---

## 10. Migration Strategy

### 10.1 v1 to v2 Migration

The system will automatically migrate v1 projects when loaded:

```typescript
function migrateV1ToV2(v1Project: ProjectBundle): ProjectV2 {
  return {
    schemaVersion: '2.0',
    projectId: v1Project.projectId,
    metadata: v1Project.metadata,
    graph: {
      rootNodeId: v1Project.mindmap.rootNodeId,
      nodes: Object.fromEntries(
        Object.entries(v1Project.mindmap.nodes).map(([id, node]) => [
          id,
          {
            ...node,
            content: {
              title: node.title,
              body: node.description,
              media: node.images?.map(img => ({
                id: img.id,
                type: 'image' as const,
                data: img.data,
                filename: img.filename,
                position: 'inline' as const
              }))
            },
            style: {
              shape: 'rounded',
              fontSize: node.level === 0 ? 'xl' : node.level === 1 ? 'lg' : 'md'
            }
          }
        ])
      ),
      edges: (v1Project.relationships || []).flatMap(rel =>
        // Convert grouped relationships to individual edges
        pairwise(rel.nodeIds).map(([from, to], i) => ({
          id: `${rel.id}-${i}`,
          sourceId: from,
          targetId: to,
          relationshipType: {
            id: 'related-to',
            name: rel.title,
            category: 'associative'
          },
          style: {
            color: rel.color,
            lineType: rel.lineType,
            lineWidth: rel.lineWidth,
            curvature: 'curved',
            arrowHead: 'none',
            arrowTail: 'none'
          },
          isVisible: rel.isVisible,
          createdAt: rel.createdAt,
          updatedAt: rel.updatedAt
        }))
      )
    },
    layout: {
      type: 'tree-horizontal',
      settings: {
        nodeSpacing: 80,
        levelSpacing: 200
      }
    },
    theme: DEFAULT_THEME
  };
}
```

---

## 11. Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Performance with large graphs (500+ nodes) | Medium | High | Virtualization, canvas culling |
| Complex layout calculations blocking UI | Medium | Medium | Web Workers for layout |
| Base64 images bloating file size | High | Medium | Optional external image URLs |
| Browser compatibility for canvas features | Low | Medium | Feature detection, fallbacks |
| Migration corrupting existing projects | Low | High | Backup before migration, validation |

---

## 12. Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Project load time (100 nodes) | < 500ms | Performance profiling |
| Layout calculation time | < 100ms | Performance profiling |
| Smooth animations | 60 FPS | Frame rate monitoring |
| Claude Code compatibility | 100% features | MCP tool coverage |
| Test coverage | > 80% | Jest coverage report |
| Zero critical bugs in prod | 0 | Bug tracking |

---

## 13. Appendix

### A. Cognitive Science References

1. Buzan, T. - "The Mind Map Book" (color, images, radial layout)
2. Paivio, A. - "Dual Coding Theory" (text + images)
3. Miller, G. - "The Magical Number Seven" (chunking)
4. Sweller, J. - "Cognitive Load Theory" (progressive disclosure)

### B. Technical References

1. Konva.js - Canvas rendering library
2. Dagre.js - Graph layout algorithms
3. Mermaid.js - Diagram rendering
4. Zustand - State management
5. Zod - Schema validation

### C. Competitive Analysis

| Feature | XMind | MindNode | MyMindmap v2 |
|---------|-------|----------|--------------|
| Rich nodes | Yes | Limited | Yes |
| Semantic edges | No | No | Yes |
| Multiple layouts | Yes | Yes | Yes |
| Presentation mode | Yes (Pitch) | No | Yes |
| AI integration | No | No | Yes (Claude) |
| Web-based | No | No | Yes |
| Open format | No | No | Yes (JSON) |

---

*End of PRD*
